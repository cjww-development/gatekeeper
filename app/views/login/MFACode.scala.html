@import controllers.ui.{routes => uiRoutes}
@import helper._
@import models.{Login => LoginModel}
@import org.joda.time.DateTime
@import views.html.Main
@import views.html.components.forms.TextInput
@import views.AuthForView
@import forms.MFACode

@(form: Form[MFACode])(implicit rh: RequestHeader, msgs: MessagesApi, lang: Lang)

@Main("Login challenge", AuthForView.isAuthenticated(rh), AuthForView.isOrgUser(rh)) {
    <form class="form-signin" action="@uiRoutes.LoginController.mfaSubmit()" method="post">
        <img class="mb-4" src="@routes.Assets.at("images/logo.png")" alt="" height="72">
        <h1 class="h3 mb-3 font-weight-normal">Login challenge</h1>

        <hr>

        @CSRF.formField

        <input type="text" name="redirect" value="@{rh.getQueryString("redirect")}" hidden />

        <p class="default-text">Enter the code generated by your authenticator app</p>

        @if(form.hasErrors) {
            @formWithErrors(form)
        } else {
            @emptyForm(form)
        }

        <hr>

        <button class="btn btn-lg btn-primary btn-block" id="registration-submit" type="submit">Verify code</button>
        <hr>

        <p class="mt-5 mb-3 text-muted">Â© CJWW Development 2016-@(DateTime.now().getYear)</p>
    </form>
}

@emptyForm(form: Form[MFACode]) = {
    @TextInput(
        form("code"),
        isReadOnly = false,
        Symbol("_id") -> "codeInput",
        Symbol("_name") -> "code",
        Symbol("_label") -> "2FA Code",
        Symbol("_type") -> "text",
        Symbol("_class") -> "form-control form-input"
    )
}

@formWithErrors(form: Form[MFACode]) = {
    @if(form("code").hasErrors) {
        @form("code").error.map { err =>
            @TextInput(
                form("code"),
                isReadOnly = false,
                Symbol("_id") -> "codeInput",
                Symbol("_name") -> "code",
                Symbol("_label") -> "2FA Code",
                Symbol("_type") -> "text",
                Symbol("_class") -> "form-control form-input-topper"
            )

            <div class="alert alert-danger form-input-bottom alert-error-border" role="alert">
                @err.message
            </div>
        }
    }
}